<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUMINA - Garden of Memories</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #faf9f6; color: #44403c; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tree-transition { transition: all 1s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const TreeGraphic = ({ entries = [], size = "large" }) => {
            const count = entries.length;
            const scale = count >= 10 ? 1.15 : count >= 5 ? 1.08 : 1.0;
            return (
                <div className="flex justify-center tree-transition" style={{ transform: `scale(${scale})`, transformOrigin: 'bottom' }}>
                    <svg width={size === "small" ? 60 : 300} height={size === "small" ? 40 : 200} viewBox="0 0 200 120">
                        <path d="M92 120 Q100 118 100 105 T108 120" fill="#D6D3D1" />
                        <path d="M10 85 Q10 25 100 20 T190 85 Q190 100 100 105 T10 85" fill={count > 0 ? "#34d399" : "#faf9f6"} stroke="#e5e7eb" />
                    </svg>
                </div>
            );
        };

        function App() {
            const [view, setView] = useState('list');
            const [diaries, setDiaries] = useState([]);
            const [active, setActive] = useState(null);
            const [entries, setEntries] = useState([]);

            useEffect(() => {
                fetch('LuminaServlet?action=list').then(r => r.json()).then(setDiaries).catch(()=>{});
            }, []);

            const fetchEntries = (id) => {
                fetch(`LuminaServlet?action=getEntries&groupId=${id}`).then(r => r.json()).then(setEntries).catch(()=>{});
            };

            if (view === 'list') {
                return (
                    <div className="max-w-md mx-auto p-8 min-h-screen">
                        <h1 className="text-5xl font-serif font-bold text-center mt-20 mb-10 text-stone-800">LUMINA</h1>
                        <div className="space-y-4">
                            {diaries.length === 0 ? <p className="text-center text-stone-300">庭園がまだありません</p> : 
                            diaries.map(d => (
                                <div key={d.group_id} onClick={() => { setActive({id: d.group_id, name: d.group_name}); fetchEntries(d.group_id); setView('app'); }} className="bg-white p-6 rounded-3xl shadow-sm border cursor-pointer hover:shadow-md transition-all">
                                    <h3 className="font-bold text-stone-700">{d.group_name}</h3>
                                    <p className="text-xs text-stone-400">ID: {d.group_id}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-md mx-auto p-4 min-h-screen bg-white">
                    <header className="flex items-center gap-4 mb-8">
                        <button onClick={() => setView('list')} className="text-stone-400 text-2xl">←</button>
                        <h2 className="text-xl font-bold text-stone-800">{active?.name}</h2>
                    </header>
                    <TreeGraphic entries={entries} />
                    <div className="mt-10 text-center text-stone-400 italic font-serif">Growing with your memories...</div>
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
